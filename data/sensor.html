<!DOCTYPE html>
<html>
<head>
<style>
body, html {
  height: 100%;
  font-family: Arial, Helvetica, sans-serif;
  background-color: #000000;
  color: #ff3300
}

table, th, td {
  border: 5px "#ff3300";
  border-collapse: collapse;
}
th, td {
  padding: 15px;
  text-align: left;
}
table#t01 {
  width: 100%;    
  background-color: powderblue;
}
</style>
</head>


<body>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<div id="demo">
  <CENTER><h1>Bike Dashboard </h1>
  <h4>I-Squared OT Labs</h4> </CENTER>
</div>


<script>

function ResetTrip()
{
   var xhttp = new XMLHttpRequest();
   var resp;
   xhttp.onreadystatechange = function() 
   {
      if (this.readyState == 4 && this.status == 200) 
      {
           resp = this.responseText;
      }
   };
   xhttp.open("POST", "resettrip", true);
   xhttp.send();
}
function Reset()
{
   var xhttp = new XMLHttpRequest();
   var resp;
   xhttp.onreadystatechange = function() 
   {
      if (this.readyState == 4 && this.status == 200) 
      {
           resp = this.responseText;
      }
   };
   xhttp.open("POST", "reset", true);
   xhttp.send();
}

function SetDate()
{
   var xhttp = new XMLHttpRequest();
   var resp;
   var x ;
   var data = new FormData();
   //var datestr = new Date();
   var datestr = 'hello date';
   datestr = document.getElementById("id1").value; 
   //data.append('ctime', 'Hello');
   data.append('ctime', datestr);
   //data.append('cdata', 'password');
   //data.append('organization', 'place');
   //data.append('requiredkey', 'key');

   xhttp.onreadystatechange = function()
   {
      if (this.readyState == 4 && this.status == 200)
      {
           resp = this.responseText;
      }
   };
   xhttp.open("PUT", "setdate", true);
   xhttp.send(data);
}

function SetTime()
{
   var xhttp = new XMLHttpRequest();
   var resp;
   var x ;
   var data = new FormData();
   //var datestr = new Date();
   var datestr = 'hello date';
   datestr = document.getElementById("id2").value;
   //data.append('ctime', 'Hello');
   data.append('ctime', datestr);

   xhttp.onreadystatechange = function()
   {
      if (this.readyState == 4 && this.status == 200)
      {
           resp = this.responseText;
      }
   };
   xhttp.open("PUT", "settime", true);
   xhttp.send(data);
}

function loop()
{
   var xhttp = new XMLHttpRequest();
   today = new Date() ;
   time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
   currentTime    = time ;
   xhttp.onreadystatechange = function() 
   {
      if (this.readyState == 4 && this.status == 200)
      {
         var jsonObject  = JSON.parse(this.responseText );
         speed           = jsonObject.Speed;
         cadence         = jsonObject.Cadence;
         distance        = jsonObject.Distance;
         totaldistance   = jsonObject.TotalDistance;
         bikeStatus      = jsonObject.Status;
         duration        = jsonObject.Duration;
         satellites      = jsonObject.Satellites;
         bodyTemperature = jsonObject.BodyTemperature ;
         pulse           = jsonObject.Pulse;
		 gCounterPrev    = gCounter ;
		 gCounter        = jsonObject.KeepAlive ;
      }
	  
   };
   if (gCounter > gCounterPrev)
   {
      indicatorStatus = "Yes" ;
	  gCounterPrev    = gCounter ;
   }
   else
   {
     indicatorStatus = "No" ;
   }
   xhttp.open("POST", "speed", true);
   xhttp.send();



   var str = "Speed: "+ speed.toString();
   str = str.fontsize("6"); // sets size of the text to 6
   //str = str.fontcolor("#006400"); // sets color of the text to #006400
   str = str.bold(); // makes text bold
   document.getElementById('speed').innerHTML = str;
   
   var str = "RPM: "+ cadence.toString();
   str = str.fontsize("6"); // sets size of the text to 6
   //str = str.fontcolor("#006400"); // sets color of the text to #006400
   str = str.bold(); // makes text bold
   document.getElementById('cadence').innerHTML = str;


   var str = "Distance: "+ distance.toString();
   str = str.fontsize("6"); // sets size of the text to 6
   //str = str.fontcolor("#006400"); // sets color of the text to #006400
   str = str.bold(); // makes text bold
   document.getElementById('distance').innerHTML = str;

   str = "Pulse: "+ pulse 
   str = str.fontsize(4); // sets size of the text to 6
   //str = str.fontcolor("#006400"); // sets color of the text to #006400
   str = str.bold(); // makes text bold
   document.getElementById('hb').innerHTML = str;

   str = "Usage: "+ totaldistance;
   str = str.fontsize(fontSize); // sets size of the text to 6
   //str = str.fontcolor("#006400"); // sets color of the text to #006400
   str = str.bold(); // makes text bold
   document.getElementById('totaldistance').innerHTML = str;
   
   str = "Time: "+ currentTime;
   str = str.fontsize(4); // sets size of the text to 6
   //str = str.fontcolor("#006400"); // sets color of the text to #006400
   str = str.bold(); // makes text bold
   document.getElementById('currenttime').innerHTML = str;
   
   str = "Duration: "+ duration;
   str = str.fontsize(4); // sets size of the text to 6
   //str = str.fontcolor("#006400"); // sets color of the text to #006400
   str = str.bold(); // makes text bold
   document.getElementById('rideduration').innerHTML = str;

   str = "GPS Fix: "+ satellites;
   str = str.fontsize(4); // sets size of the text to 6
   //str = str.fontcolor("#006400"); // sets color of the text to #006400
   str = str.bold(); // makes text bold
   document.getElementById('satellites').innerHTML = str;
   
   str = "Bike:"+ bikeStatus;
   str = str.fontsize(4); // sets size of the text to 6
   //str = str.fontcolor("#006400"); // sets color of the text to #006400
   str = str.bold(); // makes text bold
   document.getElementById('bikestatus').innerHTML = str;
   
   
   str = "Body Temp:"+ bodyTemperature;
   str = str.fontsize(4); // sets size of the text to 6
   //str = str.fontcolor("#006400"); // sets color of the text to #006400
   str = str.bold(); // makes text bold
   document.getElementById('bodyTemperature').innerHTML = str;
   
   str = indicatorStatus.toString() ;
   str = str.fontsize(4); // sets size of the text to 6
   //str = str.fontcolor("#006400"); // sets color of the text to #006400
   str = str.bold(); // makes text bold
   document.getElementById('indicator').innerHTML = str;

   mystartup();

}

function mystartup(){
    setTimeout(function(){ loop(); }, 1000);

}



var kickstart     = new mystartup();
var pulse         =  0;
var speed         =  0;
var cadence       =  0;
var distance      =  0;
var totaldistance =  0;
var bodyTemperature = 0 ;
var bikeStatus    = "Stopped"
var duration      = 0;
var fontSize      = 6;
var satellites    = "0"
var today         = new Date();
var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
var currentTime   = time;
var gCounter      = 0;
var gCounterPrev  = 0;
var indicatorStatus = 0 ;

</script>

<head>
<style>
body, html {
  height: 100%;
  font-family: Arial, Helvetica, sans-serif;
  background-color: #000000;
  color: #ff3300
}

table, th, td {
  border: 5px "#ff3300";
  border-collapse: collapse;
}
th, td {
  padding: 15px;
  text-align: left;
}
table#t01 {
  width: 100%;
  background-color: powderblue;
}
        
</style>
</head>

<table border="5">


<TR> 
   <Td> <div id="speed"></div> </td>
   <Td> <div id="cadence"></div> </td>
</TR>


<TR> 
   <TI> <Td> <div id="distance"></div> </td></TI>
   <TI> <Td> <div id="totaldistance"></div> </td></TI>
</TR>

</TABLE>
<hr>
<table border="5">

<TR> 
   <TI> <Td> <div id="currenttime"></div> </td></TI>
   <TI> <Td> <div id="rideduration"></div> </td></TI>
</TR>

<TR>
   <TI> <Td> <div id="hb"></div> </td></TI>
   <TI> <Td> <div id="bodyTemperature"></div> </td></TI> 
</TR>
<TR>
   <TI> <Td> <div id="bikestatus"></div> </td></TI>
   <TI> <Td> <div id="satellites"></div> </td></TI>
   <TI> <TD> <div id="indicator"></div> </TD> </TI>
</TR>

</Table>
<hr>


</body>
</html>
